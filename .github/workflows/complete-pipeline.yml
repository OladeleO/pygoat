name: CI/CD Pipeline

# Trigger on push, pull request, or manually
on:
  push:
  pull_request:
  workflow_dispatch:

jobs:

  sca-trivy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Trivy
        run: |
          sudo apt-get install -y wget
          wget https://github.com/aquasecurity/trivy/releases/download/v0.20.2/trivy_0.20.2_Linux-64bit.deb
          sudo dpkg -i trivy_0.20.2_Linux-64bit.deb

      - name: Run Trivy SCA Scan
        run: |
          trivy fs --scanners vuln --severity HIGH,CRITICAL --format json -o trivy-report.json .

      - name: Upload Trivy JSON Report
        uses: actions/upload-artifact@v3
        with:
          name: trivy-sca-json-report
          path: ./trivy-report.json
